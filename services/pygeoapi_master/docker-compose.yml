services:
  pygeoapi_master:
    image: geopython/pygeoapi:latest
    container_name: pygeoapi_master
    restart: unless-stopped
    expose:
      - "80"
#    ports:
#     - "5000:80"
    environment:
     - SCRIPT_NAME=/master
    labels:
      - "traefik.enable=true"
      # Production router (HTTPS with Let's Encrypt)
      - "traefik.http.routers.pygeoapi_master.rule=Host(`${SITE_DOMAIN}`) && PathPrefix(`/master`)"
      - "traefik.http.routers.pygeoapi_master.entrypoints=https"
      - "traefik.http.routers.pygeoapi_master.tls.certresolver=le"
      - "traefik.http.routers.pygeoapi_master.tls.options=tls_default@file"
      - "traefik.http.routers.pygeoapi_master.priority=100"
      - "traefik.http.routers.pygeoapi_master.middlewares=secure-headers@file"
      # Localhost router (HTTP only)
      - "traefik.http.routers.pygeoapi_master_local.rule=Host(`localhost`) && PathPrefix(`/master`)"
      - "traefik.http.routers.pygeoapi_master_local.entrypoints=http"
      - "traefik.http.routers.pygeoapi_master_local.priority=100"

    volumes:
      - ./local.config.yml:/pygeoapi/local.config.yml:ro
      - ./data:/pygeoapi/data:ro
      - ./demo.pygeoapi.io.cron:/etc/cron.d/demo.pygeoapi.io.cron:ro

networks:
  default:
    name: pygeoapi-network
    external: true
